document.addEventListener('DOMContentLoaded', () => {
  const navbar = document.querySelector('.navbar');
  const buttons = document.querySelectorAll('.module-btn');

  // Navbar shrink effect
  if (navbar) {
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) navbar.classList.add('shrink');
      else navbar.classList.remove('shrink');
    });
  }

  // Animate module buttons
  buttons.forEach((btn, index) => {
    btn.style.animation = `fadeInUp 0.6s ease forwards ${index * 0.2}s`;
  });

  // Initialize particles.js background if available
  if (window.particlesJS) {
    particlesJS('particles-js', {
      particles: {
        number: { value: 80 },
        size: { value: 3 },
        move: { speed: 1 },
        line_linked: { enable: true },
      },
    });
  }

  // Ripple click effect
  buttons.forEach(btn => {
    btn.addEventListener('click', function (e) {
      const circle = document.createElement('span');
      const diameter = Math.max(this.clientWidth, this.clientHeight);
      const radius = diameter / 2;

      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - this.offsetLeft - radius}px`;
      circle.style.top = `${e.clientY - this.offsetTop - radius}px`;
      circle.classList.add('ripple');

      const existingRipple = this.getElementsByClassName('ripple')[0];
      if (existingRipple) existingRipple.remove();

      this.appendChild(circle);
    });
  });
});

// Navigation function (fixed event usage)
function navigateToModule(ev, link) {
  const btn = ev.target.closest('.module-btn');
  if (!btn) return;

  // Disable button to prevent double clicks
  btn.style.opacity = '0.7';
  btn.style.pointerEvents = 'none';

  // Create spinner
  const spinner = document.createElement('div');
  spinner.className = 'loading-spinner';
  spinner.style.cssText =
    'width:20px;height:20px;border:2px solid rgba(255,255,255,0.3);' +
    'border-top:2px solid white;border-radius:50%;animation:spin 1s linear infinite;margin-left:10px';
  btn.appendChild(spinner);

  // Announce to screen reader (if available)
  if (window.announceToScreenReader) {
    window.announceToScreenReader(`Navigating to ${link}`);
  }

  // Delay redirect for smooth animation
  setTimeout(() => (window.location.href = link), 500);
}

// Expose function globally
window.QRAttendance = {
  navigateToModule,
};

// CSS animation keyframes (if injected dynamically)
const style = document.createElement('style');
style.innerHTML = `
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  transform: scale(0);
  animation: ripple 0.6s linear;
}

@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}
`;
document.head.appendChild(style);